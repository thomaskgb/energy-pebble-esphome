# Boot sequence component for Energy Pebble
# Handles LED animations during startup

# Boot sequence - pulse yellow LEDs during startup
script:
  - id: boot_led_sequence
    then:
      - logger.log:
          level: INFO
          format: "Starting boot LED sequence - pulsing yellow"
      - while:
          condition:
            lambda: 'return !id(leds_set_from_api);'
          then:
            # Pulse center LED only - yellow (dim to bright to dim)
            - light.turn_on:
                id: center_led
                brightness: 20%
                red: 100%
                green: 100%
                blue: 0%
                transition_length: 1s
            - delay: 1s
            # Brighten center LED to 60%
            - light.turn_on:
                id: center_led
                brightness: 60%
                transition_length: 1s
            - delay: 1s
      - logger.log:
          level: INFO
          format: "Boot sequence complete - LEDs set with API colors"
      # Update device info sensors on boot
      - text_sensor.template.publish:
          id: device_id
          state: !lambda |-
            uint64_t mac = ESP.getEfuseMac();
            char mac_str[13];
            sprintf(mac_str, "%012llx", mac);
            return std::string(mac_str);
      - component.update: local_ip_address